
<!DOCTYPE HTML>
<html lang="" >
    <head>
        <meta charset="UTF-8">
        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <title>HLT intro Â· GitBook</title>
        <meta http-equiv="X-UA-Compatible" content="IE=edge" />
        <meta name="description" content="">
        <meta name="generator" content="GitBook 3.2.3">
        <meta name="author" content="The Starterkit team and contributors">
        
        
    
    <link rel="stylesheet" href="../gitbook/style.css">

    
            
                
                <link rel="stylesheet" href="../gitbook/gitbook-plugin-panels/panels.css">
                
            
                
                <link rel="stylesheet" href="../gitbook/gitbook-plugin-katex-auto-render/katex.min.css">
                
            
                
                <link rel="stylesheet" href="../gitbook/gitbook-plugin-highlight/website.css">
                
            
                
                <link rel="stylesheet" href="../gitbook/gitbook-plugin-search/search.css">
                
            
                
                <link rel="stylesheet" href="../gitbook/gitbook-plugin-fontsettings/website.css">
                
            
        

    

    
        
    
        
    
        
    
        
    
        
    
        
    

        
    
    
    <meta name="HandheldFriendly" content="true"/>
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <link rel="apple-touch-icon-precomposed" sizes="152x152" href="../gitbook/images/apple-touch-icon-precomposed-152.png">
    <link rel="shortcut icon" href="../gitbook/images/favicon.ico" type="image/x-icon">

    
    <link rel="next" href="tistos-diy.html" />
    
    
    <link rel="prev" href="simulation.html" />
    

    </head>
    <body>
        
<div class="book">
    <div class="book-summary">
        
            
<div id="book-search-input" role="search">
    <input type="text" placeholder="Type to search" />
</div>

            
                <nav role="navigation">
                


<ul class="summary">
    
    

    

    
        
        
    
        <li class="chapter " data-level="1.1" data-path="../">
            
                <a href="../">
            
                    
                    The LHCb Starterkit
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.1.1" data-path="../CONTRIBUTING.html">
            
                <a href="../CONTRIBUTING.html">
            
                    
                    Contributing
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    

    
        
        <li class="divider"></li>
        
        
    
        <li class="chapter " data-level="2.1" data-path="../first-analysis-steps/">
            
                <a href="../first-analysis-steps/">
            
                    
                    First analysis steps
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="2.1.1" data-path="../first-analysis-steps/prerequisites.html">
            
                <a href="../first-analysis-steps/prerequisites.html">
            
                    
                    Pre-workshop checklist
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="2.1.2" data-path="../first-analysis-steps/introduction-to-course.html">
            
                <a href="../first-analysis-steps/introduction-to-course.html">
            
                    
                    Goals of the course
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="2.1.3" data-path="../first-analysis-steps/dataflow.html">
            
                <a href="../first-analysis-steps/dataflow.html">
            
                    
                    The LHCb data flow
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="2.1.4" data-path="../first-analysis-steps/run-2-data-flow.html">
            
                <a href="../first-analysis-steps/run-2-data-flow.html">
            
                    
                    Changes to the data flow in Run 2
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="2.1.5" data-path="../first-analysis-steps/davinci.html">
            
                <a href="../first-analysis-steps/davinci.html">
            
                    
                    An introduction to LHCb Software
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="2.1.6" data-path="../first-analysis-steps/bookkeeping.html">
            
                <a href="../first-analysis-steps/bookkeeping.html">
            
                    
                    Finding data in the Bookkeeping
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="2.1.7" data-path="../first-analysis-steps/files-from-grid.html">
            
                <a href="../first-analysis-steps/files-from-grid.html">
            
                    
                    Downloading a file from the grid
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="2.1.8" data-path="../first-analysis-steps/interactive-dst.html">
            
                <a href="../first-analysis-steps/interactive-dst.html">
            
                    
                    Interactively exploring a DST
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="2.1.9" data-path="../first-analysis-steps/loki-functors.html">
            
                <a href="../first-analysis-steps/loki-functors.html">
            
                    
                    Fun with LoKi Functors
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="2.1.10" data-path="../first-analysis-steps/minimal-dv-job.html">
            
                <a href="../first-analysis-steps/minimal-dv-job.html">
            
                    
                    Running a minimal DaVinci job locally
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="2.1.11" data-path="../first-analysis-steps/davinci-grid.html">
            
                <a href="../first-analysis-steps/davinci-grid.html">
            
                    
                    Running DaVinci on the grid
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="2.1.12" data-path="../first-analysis-steps/add-tupletools.html">
            
                <a href="../first-analysis-steps/add-tupletools.html">
            
                    
                    TupleTools and branches
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="2.1.13" data-path="../first-analysis-steps/decay-tree-fitter.html">
            
                <a href="../first-analysis-steps/decay-tree-fitter.html">
            
                    
                    How do I use DecayTreeFitter?
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="2.1.14" data-path="../first-analysis-steps/ganga-data.html">
            
                <a href="../first-analysis-steps/ganga-data.html">
            
                    
                    More Ganga
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="2.1.15" data-path="../first-analysis-steps/eos-storage.html">
            
                <a href="../first-analysis-steps/eos-storage.html">
            
                    
                    Storing large files on EOS
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="2.1.16" data-path="../first-analysis-steps/split-jobs.html">
            
                <a href="../first-analysis-steps/split-jobs.html">
            
                    
                    Splitting a job into subjobs
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="2.1.17" data-path="../first-analysis-steps/lhcb-dev.html">
            
                <a href="../first-analysis-steps/lhcb-dev.html">
            
                    
                    Developing LHCb Software
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="2.1.18" data-path="../first-analysis-steps/asking-questions.html">
            
                <a href="../first-analysis-steps/asking-questions.html">
            
                    
                    Asking good questions
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="2.1.19" data-path="../first-analysis-steps/ecgd.html">
            
                <a href="../first-analysis-steps/ecgd.html">
            
                    
                    Early career, gender and diversity
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="2.1.20" data-path="../first-analysis-steps/contributing-lesson.html">
            
                <a href="../first-analysis-steps/contributing-lesson.html">
            
                    
                    Contribute to this lesson
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    

    
        
        <li class="divider"></li>
        
        
    
        <li class="chapter " data-level="3.1" data-path="./">
            
                <a href="./">
            
                    
                    Second analysis steps
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="3.1.1" data-path="lb-git.html">
            
                <a href="lb-git.html">
            
                    
                    Using git to develop LHCb software
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="3.1.2" data-path="building-decays.html">
            
                <a href="building-decays.html">
            
                    
                    Building your own decay
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="3.1.2.1" data-path="building-decays-part0.html">
            
                <a href="building-decays-part0.html">
            
                    
                    The Selection Framework
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="3.1.2.2" data-path="building-decays-part1.html">
            
                <a href="building-decays-part1.html">
            
                    
                    A Historical Approach
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="3.1.2.3" data-path="building-decays-part2.html">
            
                <a href="building-decays-part2.html">
            
                    
                    Modern Selection Framework
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="3.1.3" data-path="fixing-errors.html">
            
                <a href="fixing-errors.html">
            
                    
                    What to do when something fails
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="3.1.4" data-path="rerun-stripping.html">
            
                <a href="rerun-stripping.html">
            
                    
                    Run a different stripping line on simulated data
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="3.1.5" data-path="switch-mass-hypo.html">
            
                <a href="switch-mass-hypo.html">
            
                    
                    Replace a mass hypothesis
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="3.1.6" data-path="filter-in-trees.html">
            
                <a href="filter-in-trees.html">
            
                    
                    Reuse particles from a decay tree
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="3.1.7" data-path="simulation.html">
            
                <a href="simulation.html">
            
                    
                    The simulation framework
            
                </a>
            

            
        </li>
    
        <li class="chapter active" data-level="3.1.8" data-path="hlt-intro.html">
            
                <a href="hlt-intro.html">
            
                    
                    HLT intro
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="3.1.9" data-path="tistos-diy.html">
            
                <a href="tistos-diy.html">
            
                    
                    TisTos DIY
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="3.1.10" data-path="ganga-scripting.html">
            
                <a href="ganga-scripting.html">
            
                    
                    Ganga Scripting
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="3.1.11" data-path="managing-files-with-ganga.html">
            
                <a href="managing-files-with-ganga.html">
            
                    
                    Managing files in Ganga
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="3.1.12" data-path="analysis-automation-snakemake.html">
            
                <a href="analysis-automation-snakemake.html">
            
                    
                    Analysis automation: snakemake
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    

    
        
        <li class="divider"></li>
        
        
    
        <li class="chapter " data-level="4.1" >
            
                <a target="_blank" href="ref://starterkit-lessons.pdf">
            
                    
                    Download PDF
            
                </a>
            

            
        </li>
    

    

    <li class="divider"></li>

    <li>
        <a href="https://www.gitbook.com" target="blank" class="gitbook-link">
            Published with GitBook
        </a>
    </li>
</ul>


                </nav>
            
        
    </div>

    <div class="book-body">
        
            <div class="body-inner">
                
                    

<div class="book-header" role="navigation">
    

    <!-- Title -->
    <h1>
        <i class="fa fa-circle-o-notch fa-spin"></i>
        <a href=".." >HLT intro</a>
    </h1>
</div>




                    <div class="page-wrapper" tabindex="-1" role="main">
                        <div class="page-inner">
                            
<div id="book-search-results">
    <div class="search-noresults">
    
                                <section class="normal markdown-section">
                                
                                <h1 id="hlt-intro">HLT intro</h1>
<p><div class="panel panel-warning"><div class="panel-heading"><h3 class="panel-title" onclick="javascript:toggle(3677783651);" id="learning-objectives"><i class="fa fa-line-chart"></i> Learning Objectives<span id="heading-3677783651"></span></h3></div><div class="panel-body" id="panel-3677783651"><ul>
<li>Learn about the LHCb trigger.</li>
<li>Learn how to run Moore from settings and from TCK.</li>
<li>Getting started with writing your own trigger selection.</li>
</ul>
</div></div> </p>
<p>The LHCb trigger reduces the input rate event rate of approximately 30 MHz
to 12.5 kHz of events that are written to offline tape storage. The rate
reduction is achieved in three steps: L0, HLT1 and HLT2. L0 is implemented in
custom FPGAs, has a fixed latency of 4 &#x3BC;s and a maximum output rate of 1 MHz.
HLT stands for High Level Trigger.</p>
<p>HLT1 and HLT2 are implemented as software applications that run on the online
farm; HLT1 runs in real-time and writes events to the local harddrives of the
farm machines, while HLT2 uses the rest of the available CPU (100% when there is
no beam) to process the events written by HLT1. The evolution of the disk buffer is
shown in the figure below. Events accepted by HLT2 are sent to offline storage.</p>
<p><img src="img/DiskBuffer2016.png" alt="Disk buffer in 2016" style="width: 500px;"></p>
<p>In Run I, both the reconstructions and selections used by HLT1, HLT2 and offline
were very different. In Run 2 the reconstructions used in HLT2 and offline are
identical, while selections might still be different. To be fast, HLT1 runs a subset
of the HLT2 reconstruction, for example HLT1 provides only tracks with PT &gt; 500 MeV
and only Muon particle identification. We will see the difference in speed in the following. </p>
<p>A new feature in Run 2 is the so-called Turbo stream. Since the reconstruction
available in HLT2 is the same as the offline reconstruction, physics analyses
can be done with the candidates created in HLT2. If a line is configured to be a
Turbo line, all information on the candidates that it selects is stored in the
raw event. The rest of the raw event, like sub-detector raw banks, is discarded,
and cannot be recovered offline. The advantage of the Turbo stream is that
less data are written to tape and no CPU intensive offline processing is needed.</p>
<p>The application of the software trigger is called Moore. Moore relies on the same
algorithms as are used in Brunel to run the reconstruction and in DaVinci to
select particle decays.</p>
<h3 id="run-moore-from-settings">Run Moore from settings</h3>
<p>Let&apos;s start with a simple Moore script, we call it runMoore.py:</p>
<pre><code class="lang-python"><span class="hljs-keyword">from</span> Configurables <span class="hljs-keyword">import</span> Moore
<span class="hljs-comment"># Define settings</span>
Moore().ThresholdSettings = <span class="hljs-string">&quot;Physics_pp_2017&quot;</span>
Moore().RemoveInputHltRawBanks = <span class="hljs-keyword">True</span>
Moore().Split = <span class="hljs-string">&apos;&apos;</span>
<span class="hljs-comment"># A bit more output</span>
<span class="hljs-keyword">from</span> Gaudi.Configuration <span class="hljs-keyword">import</span> INFO
Moore().EnableTimer = <span class="hljs-keyword">True</span>
Moore().OutputLevel = INFO
<span class="hljs-comment"># Input data</span>
<span class="hljs-keyword">from</span> PRConfig <span class="hljs-keyword">import</span> TestFileDB
<span class="hljs-comment"># The following call configures input data, database tags and data type</span>
TestFileDB.test_file_db[<span class="hljs-string">&quot;2016NB_25ns_L0Filt0x1609&quot;</span>].run(configurable=Moore())
Moore().DataType = <span class="hljs-string">&quot;2017&quot;</span>
<span class="hljs-comment"># Override the TCK in the ThresholdSettings to match the input data</span>
<span class="hljs-keyword">from</span> Configurables <span class="hljs-keyword">import</span> HltConf
HltConf().setProp(<span class="hljs-string">&quot;L0TCK&quot;</span>, <span class="hljs-string">&apos;0x1609&apos;</span>)
<span class="hljs-comment"># Remove a line which accepts every event when run on this sample</span>
HltConf().RemoveHlt1Lines = [<span class="hljs-string">&quot;Hlt1MBNoBias&quot;</span>]

Moore().EvtMax = <span class="hljs-number">1000</span>
<span class="hljs-keyword">print</span> Moore()
</code></pre>
<p>Try to run it with</p>
<pre><code>$ lb-run Moore/latest gaudirun.py runMoore.py | tee log.txt
</code></pre><p>The property split defines if HLT1, HLT2 or both are run. In the example above both are run.
Change <code>Moore().Split</code> to <code>&apos;Hlt1&apos;</code> and rerun.
To run HLT2 only, you have to change some settings and the input file has to be a file where
HLT1 has run on:</p>
<pre><code class="lang-python">...
Moore().RemoveInputHltRawBanks = <span class="hljs-keyword">False</span> <span class="hljs-comment"># Why?</span>
Moore().Split = <span class="hljs-string">&apos;Hlt2&apos;</span>
...
TestFileDB.test_file_db[<span class="hljs-string">&quot;2016_Hlt1_0x11361609&quot;</span>].run(configurable=Moore())
...
</code></pre>
<p>Note: HLT2 needs to know about the decisions of trigger lines used in HLT1.
The decisions are decoded from the definitions in the HLT1 TCK. Therefore, HLT2 can only
read data which have been created when running Moore from TCK and not from settings.</p>
<p><div class="panel panel-success"><div class="panel-heading"><h3 class="panel-title" onclick="javascript:toggle(9761975596);" id="compare-hlt1-and-hlt2"><i class="fa fa-square-o"></i> Compare Hlt1 and Hlt2<span id="heading-9761975596"></span></h3></div><div class="panel-body" id="panel-9761975596"><p>What is reduction factor of Hlt1? (Search how many events are accepted by <code>Hlt1Global</code>.)</p>
<p>What is reduction factor of Hlt2? (Search how many events are accepted by <code>Hlt2Global</code>.)</p>
<p>What is difference in run time of Hlt1 and Hlt2?</p>
</div></div></p>
<h3 id="run-moore-from-tck">Run Moore from TCK*</h3>
<p>There are two ways to run Moore, from <code>ThresholdSettings</code> and from <code>TCK</code> (Trigger Configuration Key).
When you develop a trigger line, it is more convenient to run from ThresholdSettings. The TCK
is used when running the trigger on the online farm or in MC productions as it uniquely defines the settings.</p>
<p><div class="panel panel-primary"><div class="panel-heading"><h3 class="panel-title" onclick="javascript:toggle(8373571336);" id="what-is-a-tck"><i class="fa fa-info-circle"></i> What is a TCK?<span id="heading-8373571336"></span></h3></div><div class="panel-body" id="panel-8373571336"><p>The Trigger Configuration Key (TCK) stores the configuration of the HLT in a 
database.
All algorithms and their properties are defined in it.
The key is usually given as a hexadecimal number. The last 4 digits define the L0 TCK.
The first 4 digits define the HLT configuration. HLT1 TCKs start with 1, HLT2 TCKs start
with 2.</p>
</div></div></p>
<p>Running from TCK has a few restrictions:
 1 The L0TCK defined in the TCK and the one in data have to match.
 2 The HltTCK might be incompatible with a Moore version if the properties of C++ algorithms changed.    </p>
<p>Here is an example script to run from an Hlt1 TCK.</p>
<pre><code class="lang-python"><span class="hljs-keyword">from</span> Configurables <span class="hljs-keyword">import</span> Moore
<span class="hljs-comment"># Define settings</span>
Moore().UseTCK = <span class="hljs-keyword">True</span>
<span class="hljs-comment"># You can check in TCKsh which TCKs exist and for which Moore versions they can be used.</span>
Moore().InitialTCK = <span class="hljs-string">&quot;0x11381609&quot;</span>
Moore().Split = <span class="hljs-string">&apos;Hlt1&apos;</span>
Moore().RemoveInputHltRawBanks = <span class="hljs-keyword">True</span>
<span class="hljs-comment"># In the online farm Moore checks if the TCK in data and the configuration are the same.</span>
<span class="hljs-comment"># Here we disable it as we run a different TCK.</span>
Moore().CheckOdin = <span class="hljs-keyword">False</span>
Moore().outputFile = <span class="hljs-string">&quot;TestTCK1.mdf&quot;</span>
<span class="hljs-comment"># A bit more output</span>
<span class="hljs-keyword">from</span> Gaudi.Configuration <span class="hljs-keyword">import</span> INFO
Moore().EnableTimer = <span class="hljs-keyword">True</span>
Moore().OutputLevel = INFO
<span class="hljs-comment"># Input data</span>
<span class="hljs-keyword">from</span> PRConfig <span class="hljs-keyword">import</span> TestFileDB
TestFileDB.test_file_db[<span class="hljs-string">&quot;2016NB_25ns_L0Filt0x1609&quot;</span>].run(configurable=Moore())
Moore().DataType = <span class="hljs-string">&quot;2016&quot;</span>
Moore().EvtMax = <span class="hljs-number">1000</span>
<span class="hljs-keyword">print</span> Moore()
</code></pre>
<p>Run with</p>
<pre><code>$ lb-run Moore/v25r4 gaudirun.py runMoore_hlt1_tck.py | tee log_hlt1_tck.txt
</code></pre><p>To run HLT2 on the output data of the first stage, use the following script:</p>
<pre><code class="lang-python"><span class="hljs-keyword">from</span> Configurables <span class="hljs-keyword">import</span> Moore
<span class="hljs-comment"># Define settings</span>
Moore().UseTCK = <span class="hljs-keyword">True</span>
Moore().InitialTCK = <span class="hljs-string">&quot;0x21381609&quot;</span>
Moore().DataType = <span class="hljs-string">&quot;2016&quot;</span>
Moore().Split = <span class="hljs-string">&apos;Hlt2&apos;</span>
Moore().RemoveInputHltRawBanks = <span class="hljs-keyword">False</span>
Moore().CheckOdin = <span class="hljs-keyword">False</span>
Moore().EnableOutputStreaming = <span class="hljs-keyword">True</span>
Moore().outputFile = <span class="hljs-string">&quot;TestTCK2.mdf&quot;</span>
<span class="hljs-comment"># A bit more output</span>
<span class="hljs-keyword">from</span> Gaudi.Configuration <span class="hljs-keyword">import</span> INFO
Moore().EnableTimer = <span class="hljs-keyword">True</span>
Moore().OutputLevel = INFO
<span class="hljs-comment"># Input data</span>
Moore().DDDBtag = <span class="hljs-string">&apos;dddb-20150724&apos;</span>
Moore().CondDBtag = <span class="hljs-string">&apos;cond-20170325&apos;</span>
Moore().inputFiles = [<span class="hljs-string">&quot;TestTCK1.mdf&quot;</span>]
Moore().EvtMax = <span class="hljs-number">100</span>
</code></pre>
<h3 id="exploring-a-tck">Exploring a TCK</h3>
<p>If you are interested in how to create a TCK, you can follow the instructions
given <a href="https://twiki.cern.ch/twiki/bin/view/LHCb/CreateSplitHltTCKs" target="_blank">here</a>.</p>
<p>To get a list of all available TCKs one can use TCKsh which is a python shell with predefined
functions to explore TCKs, do</p>
<pre><code>$ lb-run Moore/latest TCKsh  
&gt; listConfigurations()
</code></pre><p>There are other useful commands like <code>listHlt1Lines(&lt;TCK&gt;)</code> or <code>listHlt2Lines(&lt;TCK&gt;)</code>.
More advanced is to search for properties of a line. One example is to search for the prescale.
The prescale determines how often a line is executed, 1.0 means always, 0.0 never.
Type for example:</p>
<pre><code>&gt; listProperties(0x214a160f,&quot;.*Hlt2DiMuonJPsi.*&quot;,&quot;AcceptFraction&quot;)
...
&gt; listProperties(0x214a160f,&quot;.*Hlt2DiMuonJPsiPreScaler.*&quot;,&quot;AcceptFraction&quot;)
</code></pre><p><div class="panel panel-success"><div class="panel-heading"><h3 class="panel-title" onclick="javascript:toggle(6762170566);" id="compare-hlt1-lines-from-run1-and-run2"><i class="fa fa-square-o"></i> Compare HLT1 lines from Run1 and Run2<span id="heading-6762170566"></span></h3></div><div class="panel-body" id="panel-6762170566"><p>Try to find out which HLT1 lines were available in Run 1 and which are now available in Run 2.</p>
<p>What are the names of the topological trigger lines in Run 1 and Run 2?</p>
</div></div></p>
<h3 id="write-your-own-hlt2-trigger-line-or-adapt-an-existing-one">Write your own HLT2 trigger line or adapt an existing one</h3>
<p>HLT2 lines are similar to stripping lines. They combine basic particles to composite objects
and you apply selections to get a clean sample. The framework in which you write a trigger
line looks different to a stripping line but the underlying algorithms are the same.
Documentation is found <a href="https://twiki.cern.ch/twiki/bin/view/LHCb/LHCbTrigger#Developing_Hlt2_lines" target="_blank">here</a>.
There you also find information how to measure the efficiency or the output rate of a trigger line.</p>
<p>HLT2 lines are found in the Hlt gitlab project in the package Hlt2Lines, see <a href="https://gitlab.cern.ch/lhcb/Hlt/tree/master/Hlt/Hlt2Lines/python/Hlt2Lines" target="_blank">here</a>.</p>
<p>Their settings, i.e. the cut definitions, have to be defined in HltSettings package as well,
see <a href="https://gitlab.cern.ch/lhcb/Hlt/tree/master/Hlt/HltSettings/python/HltSettings" target="_blank">here</a>.</p>
<p>As a hands on, we will change the prescale of a line with a high rate and then reduce its rate with extra cuts.
First setup a Moore lb-dev project from the nightlies.</p>
<pre><code>$ lb-dev --nightly-cvmfs --nightly lhcb-head Moore/HEAD
$ cd MooreDev_HEAD
$ git lb-use Hlt
$ git lb-checkout Hlt/master Hlt/HltSettings
$ git lb-checkout Hlt/master Hlt/Hlt2Lines
$ make
</code></pre><p>Go to <code>Hlt/HltSettings/python/HltSettings/DiMuon/DiMuon_pp_2017.py</code>, search for prescale and change the prescale of <code>Hlt2DiMuonJPsi</code> to 1.0.
Run Moore again and see if the rate of this line has increased.</p>
<p>The line is defined in <code>Hlt/Hlt2Lines/python/Hlt2Lines/DiMuon/Lines.py</code>. The cut properties appear in the dictionary under <code>JPsi</code>.
Add an entry with the key <code>MinProbNN</code> and set some value. If you search for <code>JPsi</code> in the file, you will find that the lines
uses <code>JpsiFilter</code> from <code>Stages.py</code>. As it is used by another line as well, you have to add the entry to <code>JPsiHighPT</code> as well.
JpsiFilter simply uses muon pairs as input.  Go to Stages.py  and adapt the code of the <code>Hlt2ParticleFilter</code> to filter on the
pid of the muons, to do that add <code>(MINTREE(&apos;mu-&apos; == ABSID, PROBNNmu) &gt; %(MinProbNN)s )</code>
to the cut string. Run Moore again and see if the rate of this line has now decreased.</p>
<p>For more complicated developments which require changing many files or concurrent development of several people,
we encourage to use a full checkout of the <code>Moore</code> and <code>Hlt</code> projects and to use vanilla git commands.
A user friendly setup for this is being developed under the name <a href="https://gitlab.cern.ch/lhcb-HLT/trigger-dev" target="_blank">trigger-dev</a>.
We encourage people to check it out and give feedback on the <a href="https://gitlab.cern.ch/lhcb-HLT/trigger-dev/issues" target="_blank">issues page</a>.</p>
<p><div class="panel panel-success"><div class="panel-heading"><h3 class="panel-title" onclick="javascript:toggle(8651146836);" id="convert-a-stripping-line-to-a-hlt2-line"><i class="fa fa-square-o"></i> Convert a stripping line to a Hlt2 line<span id="heading-8651146836"></span></h3></div><div class="panel-body" id="panel-8651146836"><ol>
<li>Pick a stripping line and convert it to a HLT2 line.</li>
<li>Make it a Turbo line.</li>
<li>Run a rate test to determine the rate of the line.</li>
</ol>
</div></div></p>

                                
                                </section>
                            
    </div>
    <div class="search-results">
        <div class="has-results">
            
            <h1 class="search-results-title"><span class='search-results-count'></span> results matching "<span class='search-query'></span>"</h1>
            <ul class="search-results-list"></ul>
            
        </div>
        <div class="no-results">
            
            <h1 class="search-results-title">No results matching "<span class='search-query'></span>"</h1>
            
        </div>
    </div>
</div>

                        </div>
                    </div>
                
            </div>

            
                
                <a href="simulation.html" class="navigation navigation-prev " aria-label="Previous page: The simulation framework">
                    <i class="fa fa-angle-left"></i>
                </a>
                
                
                <a href="tistos-diy.html" class="navigation navigation-next " aria-label="Next page: TisTos DIY">
                    <i class="fa fa-angle-right"></i>
                </a>
                
            
        
    </div>

    <script>
        var gitbook = gitbook || [];
        gitbook.push(function() {
            gitbook.page.hasChanged({"page":{"title":"HLT intro","level":"3.1.8","depth":2,"next":{"title":"TisTos DIY","level":"3.1.9","depth":2,"path":"second-analysis-steps/tistos-diy.md","ref":"second-analysis-steps/tistos-diy.md","articles":[]},"previous":{"title":"The simulation framework","level":"3.1.7","depth":2,"path":"second-analysis-steps/simulation.md","ref":"second-analysis-steps/simulation.md","articles":[]},"dir":"ltr"},"config":{"plugins":["-sharing","panels@git+https://github.com/lhcb/gitbook-plugin-panels.git#master","katex-auto-render@git+https://github.com/lhcb/gitbook-plugin-katex-auto-render.git#master","collapsible-menu","otherlink"],"styles":{"website":"styles/website.css","pdf":"styles/pdf.css","epub":"styles/epub.css","mobi":"styles/mobi.css","ebook":"styles/ebook.css","print":"styles/print.css"},"pluginsConfig":{"collapsible-menu":{},"search":{},"otherlink":{},"lunr":{"maxIndexSize":1000000,"ignoreSpecialCharacters":false},"panels":{},"fontsettings":{"theme":"white","family":"sans","size":2},"highlight":{},"katex-auto-render":{},"theme-default":{"styles":{"website":"styles/website.css","pdf":"styles/pdf.css","epub":"styles/epub.css","mobi":"styles/mobi.css","ebook":"styles/ebook.css","print":"styles/print.css"},"showLevel":false}},"theme":"default","author":"The Starterkit team and contributors","pdf":{"pageNumbers":true,"fontSize":12,"fontFamily":"Arial","paperSize":"a4","chapterMark":"pagebreak","pageBreaksBefore":"/","margin":{"right":62,"left":62,"top":56,"bottom":56}},"structure":{"langs":"LANGS.md","readme":"README.md","glossary":"GLOSSARY.md","summary":"SUMMARY.md"},"variables":{},"gitbook":"*"},"file":{"path":"second-analysis-steps/hlt-intro.md","mtime":"2018-05-08T17:37:55.905Z","type":"markdown"},"gitbook":{"version":"3.2.3","time":"2018-05-08T17:41:37.521Z"},"basePath":"..","book":{"language":""}});
        });
    </script>
</div>

        
    <script src="../gitbook/gitbook.js"></script>
    <script src="../gitbook/theme.js"></script>
    
        
        <script src="../gitbook/gitbook-plugin-panels/panels.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-katex-auto-render/katex.min.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-katex-auto-render/auto-render.min.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-katex-auto-render/enable-auto-render.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-collapsible-menu/plugin.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-otherlink/js/otherlink.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-search/search-engine.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-search/search.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-lunr/lunr.min.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-lunr/search-lunr.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-fontsettings/fontsettings.js"></script>
        
    

    </body>
</html>

