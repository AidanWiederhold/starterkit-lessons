
<!DOCTYPE HTML>
<html lang="" >
    <head>
        <meta charset="UTF-8">
        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <title>An introduction to LHCb Software Â· GitBook</title>
        <meta http-equiv="X-UA-Compatible" content="IE=edge" />
        <meta name="description" content="">
        <meta name="generator" content="GitBook 3.2.3">
        <meta name="author" content="The Starterkit team and contributors">
        
        
    
    <link rel="stylesheet" href="../gitbook/style.css">

    
            
                
                <link rel="stylesheet" href="../gitbook/gitbook-plugin-panels/panels.css">
                
            
                
                <link rel="stylesheet" href="../gitbook/gitbook-plugin-katex-auto-render/katex.min.css">
                
            
                
                <link rel="stylesheet" href="../gitbook/gitbook-plugin-highlight/website.css">
                
            
                
                <link rel="stylesheet" href="../gitbook/gitbook-plugin-search/search.css">
                
            
                
                <link rel="stylesheet" href="../gitbook/gitbook-plugin-fontsettings/website.css">
                
            
        

    

    
        
    
        
    
        
    
        
    
        
    
        
    

        
    
    
    <meta name="HandheldFriendly" content="true"/>
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <link rel="apple-touch-icon-precomposed" sizes="152x152" href="../gitbook/images/apple-touch-icon-precomposed-152.png">
    <link rel="shortcut icon" href="../gitbook/images/favicon.ico" type="image/x-icon">

    
    <link rel="next" href="bookkeeping.html" />
    
    
    <link rel="prev" href="run-2-data-flow.html" />
    

    </head>
    <body>
        
<div class="book">
    <div class="book-summary">
        
            
<div id="book-search-input" role="search">
    <input type="text" placeholder="Type to search" />
</div>

            
                <nav role="navigation">
                


<ul class="summary">
    
    

    

    
        
        
    
        <li class="chapter " data-level="1.1" data-path="../">
            
                <a href="../">
            
                    
                    The LHCb Starterkit
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.1.1" data-path="../CONTRIBUTING.html">
            
                <a href="../CONTRIBUTING.html">
            
                    
                    Contributing
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    

    
        
        <li class="divider"></li>
        
        
    
        <li class="chapter " data-level="2.1" data-path="./">
            
                <a href="./">
            
                    
                    First analysis steps
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="2.1.1" data-path="prerequisites.html">
            
                <a href="prerequisites.html">
            
                    
                    Pre-workshop checklist
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="2.1.2" data-path="introduction-to-course.html">
            
                <a href="introduction-to-course.html">
            
                    
                    Goals of the course
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="2.1.3" data-path="dataflow.html">
            
                <a href="dataflow.html">
            
                    
                    The LHCb data flow
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="2.1.4" data-path="run-2-data-flow.html">
            
                <a href="run-2-data-flow.html">
            
                    
                    Changes to the data flow in Run 2
            
                </a>
            

            
        </li>
    
        <li class="chapter active" data-level="2.1.5" data-path="davinci.html">
            
                <a href="davinci.html">
            
                    
                    An introduction to LHCb Software
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="2.1.6" data-path="bookkeeping.html">
            
                <a href="bookkeeping.html">
            
                    
                    Finding data in the Bookkeeping
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="2.1.7" data-path="files-from-grid.html">
            
                <a href="files-from-grid.html">
            
                    
                    Downloading a file from the grid
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="2.1.8" data-path="interactive-dst.html">
            
                <a href="interactive-dst.html">
            
                    
                    Interactively exploring a DST
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="2.1.9" data-path="loki-functors.html">
            
                <a href="loki-functors.html">
            
                    
                    Fun with LoKi Functors
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="2.1.10" data-path="minimal-dv-job.html">
            
                <a href="minimal-dv-job.html">
            
                    
                    Running a minimal DaVinci job locally
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="2.1.11" data-path="davinci-grid.html">
            
                <a href="davinci-grid.html">
            
                    
                    Running DaVinci on the grid
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="2.1.12" data-path="add-tupletools.html">
            
                <a href="add-tupletools.html">
            
                    
                    TupleTools and branches
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="2.1.13" data-path="decay-tree-fitter.html">
            
                <a href="decay-tree-fitter.html">
            
                    
                    How do I use DecayTreeFitter?
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="2.1.14" data-path="ganga-data.html">
            
                <a href="ganga-data.html">
            
                    
                    More Ganga
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="2.1.15" data-path="eos-storage.html">
            
                <a href="eos-storage.html">
            
                    
                    Storing large files on EOS
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="2.1.16" data-path="split-jobs.html">
            
                <a href="split-jobs.html">
            
                    
                    Splitting a job into subjobs
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="2.1.17" data-path="lhcb-dev.html">
            
                <a href="lhcb-dev.html">
            
                    
                    Developing LHCb Software
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="2.1.18" data-path="asking-questions.html">
            
                <a href="asking-questions.html">
            
                    
                    Asking good questions
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="2.1.19" data-path="ecgd.html">
            
                <a href="ecgd.html">
            
                    
                    Early career, gender and diversity
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="2.1.20" data-path="contributing-lesson.html">
            
                <a href="contributing-lesson.html">
            
                    
                    Contribute to this lesson
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    

    
        
        <li class="divider"></li>
        
        
    
        <li class="chapter " data-level="3.1" data-path="../second-analysis-steps/">
            
                <a href="../second-analysis-steps/">
            
                    
                    Second analysis steps
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="3.1.1" data-path="../second-analysis-steps/lb-git.html">
            
                <a href="../second-analysis-steps/lb-git.html">
            
                    
                    Using git to develop LHCb software
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="3.1.2" data-path="../second-analysis-steps/building-decays.html">
            
                <a href="../second-analysis-steps/building-decays.html">
            
                    
                    Building your own decay
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="3.1.2.1" data-path="../second-analysis-steps/building-decays-part0.html">
            
                <a href="../second-analysis-steps/building-decays-part0.html">
            
                    
                    The Selection Framework
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="3.1.2.2" data-path="../second-analysis-steps/building-decays-part1.html">
            
                <a href="../second-analysis-steps/building-decays-part1.html">
            
                    
                    A Historical Approach
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="3.1.2.3" data-path="../second-analysis-steps/building-decays-part2.html">
            
                <a href="../second-analysis-steps/building-decays-part2.html">
            
                    
                    Modern Selection Framework
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="3.1.3" data-path="../second-analysis-steps/fixing-errors.html">
            
                <a href="../second-analysis-steps/fixing-errors.html">
            
                    
                    What to do when something fails
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="3.1.4" data-path="../second-analysis-steps/rerun-stripping.html">
            
                <a href="../second-analysis-steps/rerun-stripping.html">
            
                    
                    Run a different stripping line on simulated data
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="3.1.5" data-path="../second-analysis-steps/switch-mass-hypo.html">
            
                <a href="../second-analysis-steps/switch-mass-hypo.html">
            
                    
                    Replace a mass hypothesis
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="3.1.6" data-path="../second-analysis-steps/filter-in-trees.html">
            
                <a href="../second-analysis-steps/filter-in-trees.html">
            
                    
                    Reuse particles from a decay tree
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="3.1.7" data-path="../second-analysis-steps/simulation.html">
            
                <a href="../second-analysis-steps/simulation.html">
            
                    
                    The simulation framework
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="3.1.8" data-path="../second-analysis-steps/hlt-intro.html">
            
                <a href="../second-analysis-steps/hlt-intro.html">
            
                    
                    HLT intro
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="3.1.9" data-path="../second-analysis-steps/tistos-diy.html">
            
                <a href="../second-analysis-steps/tistos-diy.html">
            
                    
                    TisTos DIY
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="3.1.10" data-path="../second-analysis-steps/ganga-scripting.html">
            
                <a href="../second-analysis-steps/ganga-scripting.html">
            
                    
                    Ganga Scripting
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="3.1.11" data-path="../second-analysis-steps/managing-files-with-ganga.html">
            
                <a href="../second-analysis-steps/managing-files-with-ganga.html">
            
                    
                    Managing files in Ganga
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    

    
        
        <li class="divider"></li>
        
        
    
        <li class="chapter " data-level="4.1" >
            
                <a target="_blank" href="ref://starterkit-lessons.pdf">
            
                    
                    Download PDF
            
                </a>
            

            
        </li>
    

    

    <li class="divider"></li>

    <li>
        <a href="https://www.gitbook.com" target="blank" class="gitbook-link">
            Published with GitBook
        </a>
    </li>
</ul>


                </nav>
            
        
    </div>

    <div class="book-body">
        
            <div class="body-inner">
                
                    

<div class="book-header" role="navigation">
    

    <!-- Title -->
    <h1>
        <i class="fa fa-circle-o-notch fa-spin"></i>
        <a href=".." >An introduction to LHCb Software</a>
    </h1>
</div>




                    <div class="page-wrapper" tabindex="-1" role="main">
                        <div class="page-inner">
                            
<div id="book-search-results">
    <div class="search-noresults">
    
                                <section class="normal markdown-section">
                                
                                <h1 id="an-introduction-to-lhcb-software">An introduction to LHCb Software</h1>
<p><div class="panel panel-warning"><div class="panel-heading"><h3 class="panel-title" onclick="javascript:toggle(4485075417);" id="learning-objectives"><i class="fa fa-line-chart"></i> Learning Objectives<span id="heading-4485075417"></span></h3></div><div class="panel-body" id="panel-4485075417"><ul>
<li>Learn the key concepts needed to work with the LHCb software</li>
<li>Learn how to launch the LHCb software with <code>lb-run</code></li>
</ul>
</div></div> </p>
<p>Imagine you want to design and run a new particle detector.
Apart from organizing a collaboration, creating the design and specification, and several other tasks, you will also have to find solutions to many computational challenges.
It&apos;s worth thinking about these for a second:</p>
<ul>
<li>How do we collect data as it is recorded by the detector?</li>
<li>How do we filter and process the recorded data efficiently?</li>
<li>How do we manage all the complex tasks required to work with collision data?</li>
<li>How do we organize all the data of a single bunch crossing in a flexible way?</li>
<li>How do we configure our software flexibly without having to recompile it?</li>
<li>Can you think of more?</li>
</ul>
<p>How would you go about solving these?
The decisions you make will affect the performance of your experiment during datataking and analysis.</p>
<p>At LHCb, we base our software on the <a href="https://proj-gaudi.web.cern.ch/proj-gaudi/" target="_blank">Gaudi</a> framework, which was specifically designed with the above questions in mind.
It&apos;s worth getting an idea of some of the most important Gaudi concepts at this point.
After this, we will jump right into running the software and getting useful things done.</p>
<p><strong>Event Loop</strong>
Because the individual bunch crossings (events) are almost completely independent of each other, it makes sense to process them one by one, without holding them all in memory at once.
Gaudi provides a global EventLoop, which allows you to process events one by one.</p>
<p><strong>Transient Event Store</strong>
A single event contains lots of different data objects (Particles, Vertices, Tracks, Hits, ...).
In Gaudi, these are organized in the Transient Event Store (TES).
You can think of it as a per-event file system with locations like <code>/Event/Rec/Track/Best</code> or <code>/Event/Phys/MyParticles</code>.
When running over the event stream, Gaudi allows you to get and put from/to these locations.
The contents of the TES are emptied at the end of the processing of each event.</p>
<p><strong>Algorithms</strong>
An <em>Algorithm</em> is a C++ class that can be inserted into the EventLoop.
These allow you to perform a certain function for each event (like filtering according to trigger decision, reconstructing particles, ...).</p>
<p><strong>Tools</strong>
Often, algorithms will want to make use of some common function (vertex fitting, calculating distances, associating a primary vertex, ...).
These are implemented as <em>Tools</em>, which are shared between Algorithms.</p>
<p><strong>Options</strong>
To make all of this configurable, Gaudi allows you to set properties of <em>Algorithms</em> and <em>Tools</em> from a Python script, called an <em>option</em> file.
In an option file, you can specify which Algorithms are run in which order, and set their properties (strings, integers, doubles, and lists and dicts of these things can be set).
You can then start the Gaudi EventLoop using this option file, and it will set up and run the corresponding C++ objects with specified settings.</p>
<p>You can find comprehensive documentation in the <a href="https://proj-gaudi.web.cern.ch/proj-gaudi/releases/latest/doxygen/" target="_blank">Gaudi Doxygen</a> or the <a href="http://lhcb-comp.web.cern.ch/lhcb-comp/Frameworks/Gaudi/Gaudi_v9/GUG/GUG.pdf" target="_blank">Gaudi Manual</a>.</p>
<p>Usually, you will work with one of the LHCb software projects that are based on Gaudi.
One of the most important ones is <em>DaVinci</em>, which provides lots of <em>Algorithms</em> and <em>Tools</em> for physics analysis.</p>
<p>You can run DaVinci using the following command <a href="prerequisites.html#Pre-workshop%20checklist">on lxplus</a>:</p>
<pre><code class="lang-bash">lb-run DaVinci/v42r6p1 gaudirun.py
</code></pre>
<p>This will run the <code>gaudirun.py</code> command using version v42r6p1 of DaVinci. (<code>lb-run</code> sets the specified environment for <code>gaudirun.py</code> to run in.)
<code>gaudirun.py</code> is a script that sets up the EventLoop.
You should get the following output:</p>
<pre><code># setting LC_ALL to &quot;C&quot;
ApplicationMgr    SUCCESS
====================================================================================================================================
                                                   Welcome to DaVinci version v42r6p1
                                          running on lxplus055.cern.ch on Mon Oct 16 10:47:29 2017
====================================================================================================================================
ApplicationMgr       INFO Application Manager Configured successfully
HistogramPersis...WARNING Histograms saving not required.
ApplicationMgr       INFO Application Manager Initialized successfully
ApplicationMgr       INFO Application Manager Started successfully
EventSelector        INFO End of event input reached.
EventLoopMgr         INFO No more events in event selection
ApplicationMgr       INFO Application Manager Stopped successfully
EventLoopMgr         INFO Histograms converted successfully according to request.
ToolSvc              INFO Removing all tools created by ToolSvc
ApplicationMgr       INFO Application Manager Finalized successfully
ApplicationMgr       INFO Application Manager Terminated successfully
</code></pre><p>During this run, DaVinci didn&apos;t do anything: We didn&apos;t specify any algorithms to run or any data to run over.
Usually, you will write an option file (e.g. <code>options.py</code>) and specify it as an argument to <code>gaudirun.py</code>:</p>
<pre><code class="lang-bash">lb-run DaVinci/v42r6p1 gaudirun.py options.py
</code></pre>
<p>An <code>option.py</code> is just a regular Python script that specifies how to set things up in the software.
Many of the following lessons will teach you how to do something with DaVinci by showing you how to write or extend an <code>options.py</code>.
You can use the above command to test it.
You can also specify several option files like this:</p>
<pre><code class="lang-bash">lb-run DaVinci/v42r6p1 gaudirun.py options1.py options2.py
</code></pre>
<p>They will then both be used to set up DaVinci.</p>
<p>Do you want to get an overview of which versions of DaVinci exist? Use</p>
<pre><code class="lang-bash">lb-run --list DaVinci
</code></pre>
<p>Do you want to start a shell that already contains the LHCb environment, so you don&apos;t have to use <code>lb-run</code>?
Execute</p>
<pre><code class="lang-bash">lb-run DaVinci/v42r6p1 <span class="hljs-variable">$SHELL</span>
</code></pre>
<blockquote>
<p>Note that sometimes this environment can result in failing scripts due to struggles with your shell&apos;s rc file (e.g., <code>~/.bashrc</code>). Using, e.g.,</p>
<pre><code class="lang-bash">lb-run DaVinci/v42r6p1 bash --norc
</code></pre>
<p>avoids this, but means you won&apos;t be able to use any aliases, etc, included in the ignored rc file.</p>
</blockquote>
<p>A simple <code>gaudirun.py</code> should work as well now.
Typing <code>exit</code> or using <code>Ctrl-d</code> will close the shell and leave the LHCb environment behind.</p>
<p><div class="panel panel-primary"><div class="panel-heading"><h3 class="panel-title" onclick="javascript:toggle(57372799);" id="using-setupproject-instead-of-lb-run"><i class="fa fa-info-circle"></i> Using SetupProject instead of lb-run<span id="heading-57372799"></span></h3></div><div class="panel-body" id="panel-57372799"><p>When reading through other tutorials, you will come across <code>SetupProject</code>.
This is an older way of setting up a shell that is configured to run LHCb software.
<code>lb-run</code> is the new way of doing things and has some nice benefits over <code>SetupProject</code>.
For most purposes, <code>SetupProject DaVinci v42r6p1</code> is equivalent to</p>
<pre><code class="lang-bash">lb-run DaVinci/v42r6p1 <span class="hljs-variable">$SHELL</span>
</code></pre>
<p>but you should really avoid doing things this way as this method is no longer supported for the latest project releases. (The environment for DaVinci v42r6p1, for example, cannot be started this way.)</p>
</div></div> </p>

                                
                                </section>
                            
    </div>
    <div class="search-results">
        <div class="has-results">
            
            <h1 class="search-results-title"><span class='search-results-count'></span> results matching "<span class='search-query'></span>"</h1>
            <ul class="search-results-list"></ul>
            
        </div>
        <div class="no-results">
            
            <h1 class="search-results-title">No results matching "<span class='search-query'></span>"</h1>
            
        </div>
    </div>
</div>

                        </div>
                    </div>
                
            </div>

            
                
                <a href="run-2-data-flow.html" class="navigation navigation-prev " aria-label="Previous page: Changes to the data flow in Run 2">
                    <i class="fa fa-angle-left"></i>
                </a>
                
                
                <a href="bookkeeping.html" class="navigation navigation-next " aria-label="Next page: Finding data in the Bookkeeping">
                    <i class="fa fa-angle-right"></i>
                </a>
                
            
        
    </div>

    <script>
        var gitbook = gitbook || [];
        gitbook.push(function() {
            gitbook.page.hasChanged({"page":{"title":"An introduction to LHCb Software","level":"2.1.5","depth":2,"next":{"title":"Finding data in the Bookkeeping","level":"2.1.6","depth":2,"path":"first-analysis-steps/bookkeeping.md","ref":"first-analysis-steps/bookkeeping.md","articles":[]},"previous":{"title":"Changes to the data flow in Run 2","level":"2.1.4","depth":2,"path":"first-analysis-steps/run-2-data-flow.md","ref":"first-analysis-steps/run-2-data-flow.md","articles":[]},"dir":"ltr"},"config":{"plugins":["-sharing","panels@git+https://github.com/lhcb/gitbook-plugin-panels.git#master","katex-auto-render@git+https://github.com/lhcb/gitbook-plugin-katex-auto-render.git#master","collapsible-menu","otherlink"],"styles":{"website":"styles/website.css","pdf":"styles/pdf.css","epub":"styles/epub.css","mobi":"styles/mobi.css","ebook":"styles/ebook.css","print":"styles/print.css"},"pluginsConfig":{"collapsible-menu":{},"search":{},"otherlink":{},"lunr":{"maxIndexSize":1000000,"ignoreSpecialCharacters":false},"panels":{},"fontsettings":{"theme":"white","family":"sans","size":2},"highlight":{},"katex-auto-render":{},"theme-default":{"styles":{"website":"styles/website.css","pdf":"styles/pdf.css","epub":"styles/epub.css","mobi":"styles/mobi.css","ebook":"styles/ebook.css","print":"styles/print.css"},"showLevel":false}},"theme":"default","author":"The Starterkit team and contributors","pdf":{"pageNumbers":true,"fontSize":12,"fontFamily":"Arial","paperSize":"a4","chapterMark":"pagebreak","pageBreaksBefore":"/","margin":{"right":62,"left":62,"top":56,"bottom":56}},"structure":{"langs":"LANGS.md","readme":"README.md","glossary":"GLOSSARY.md","summary":"SUMMARY.md"},"variables":{},"gitbook":"*"},"file":{"path":"first-analysis-steps/davinci.md","mtime":"2018-05-07T09:33:57.314Z","type":"markdown"},"gitbook":{"version":"3.2.3","time":"2018-05-07T09:35:59.678Z"},"basePath":"..","book":{"language":""}});
        });
    </script>
</div>

        
    <script src="../gitbook/gitbook.js"></script>
    <script src="../gitbook/theme.js"></script>
    
        
        <script src="../gitbook/gitbook-plugin-panels/panels.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-katex-auto-render/katex.min.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-katex-auto-render/auto-render.min.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-katex-auto-render/enable-auto-render.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-collapsible-menu/plugin.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-otherlink/js/otherlink.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-search/search-engine.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-search/search.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-lunr/lunr.min.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-lunr/search-lunr.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-fontsettings/fontsettings.js"></script>
        
    

    </body>
</html>

